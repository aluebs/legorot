<!DOCTYPE html>
<html>
  <head>
    <title>LegoRot</title>
    <script>
      function radiusSquared(a, b) {
        return Math.pow(a, 2) + Math.pow(b, 2);
      }

      function GCD(a, b) {
        while(b) {
          var bb = b;
          b = a % b;
          a = bb;
        }
        return a;
      }

      function calculateAngles(form) {
        var height = form.height.value;
        var width = form.width.value;
        var min_connections = form.min_connections.value;

        var inter_width = 2 * width;
        var inter_height = 2 * height;
        var max_radius =
          Math.ceil(Math.sqrt(radiusSquared(inter_width, inter_height)));

        var radius_map = {};
        for (var i = 0; i <= max_radius; ++i) {
          for (var j = 0; j <= max_radius; ++j) {
            var radius = radiusSquared(i, j);
            if (radius > 0 && radius <= Math.pow(max_radius, 2)) {
              if (radius in radius_map) {
                radius_map[radius].add([i, j]);
              } else {
                radius_map[radius] = new Set([[i, j]]);
              }
            }
          }
        }

        var angle_map = {};
        for (var radius in radius_map) {
          var positions = radius_map[radius];
          for (var pos_fix of positions) {
            for (var pos_rot of positions) {
              if (pos_rot[0] <= inter_width && pos_rot[1] <= inter_height) {
                var pos_wrp = pos_fix;
                if (pos_wrp[0] > pos_rot[0]) {
                  pos_wrp = [-pos_wrp[1], pos_wrp[0]];
                }
                var angle = [radiusSquared(pos_rot[0] - pos_wrp[0],
                                           pos_rot[1] - pos_wrp[1]),
                             4 * radius];
                var gcd = GCD(angle[0], angle[1]);
                if (gcd) {
                  angle = [angle[0] / gcd, angle[1] / gcd];
                }
                if (angle in angle_map) {
                  angle_map[angle].add(pos_rot);
                } else {
                  angle_map[angle] = new Set([pos_rot]);
                }
              }
            }
          }
        }

        var num_angles = 0;
        for (var angle in angle_map) {
          var connections = angle_map[angle];
          connections.add([0, 0]);
          if (angle == [1, 2] || connections.size < min_connections) {
            delete angle_map[angle];
          } else {
            ++num_angles;
          }
        }

        document.getElementById("angle").max = num_angles - 1;

        console.log(angle_map);
      }

      function selectAngle(index) {
        document.getElementById("angle_text").textContent = index;
      }
    </script>
  </head>
  <body>
    <h1>LegoRot</h1>
    <div>
      <form action="javascript:calculateAngles(this);">
        <table>
          <tr>
            <td><label for="height">Height:</label></td>
            <td><input type="number" id="height" value=2></td>
          </tr>
          <tr>
            <td><label for="width">Width:</label></td>
            <td><input type="number" id="width" value=2></td>
          </tr>
          <tr>
            <td><label for="min_connections">Min Connections:</label></td>
            <td><input type="number" id="min_connections" value=5></td>
          </tr>
          <tr>
            <td><input type="submit" value="Calculate Angles"></td>
          </tr>
        </table>
      </form>
    </div>
    <div>
      <form>
        <label for="angle">Angle:</label>
        <span id="angle_text">0</span>
        <input type="range" id="angle" max="0" value="0"
            oninput="selectAngle(this.value)"
            onchange="selectAngle(this.value)">
      </form>
    </div>
  </body>
</html>
